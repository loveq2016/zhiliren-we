#set($base = '${base}')
#set($url = '${url}')
#set($obj = '${obj.')
#set($one = '${one.')
#set($one_id='${one.id}')
#set($obj_pager='${obj}')
#set($obj_pageNumber='${obj.pageNumber}')
#set($obj_pageSize='${obj.pageSize}')
<%@ page contentType="text/html; charset=UTF-8" language="java" pageEncoding="UTF-8" errorPage="/WEB-INF/common/500.jsp"%>
<%@include file="/WEB-INF/common/tld.jsp"%>

<c:set var="url" value="$base$atUrl" />
<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>$moudleName</title>
		<link rel="stylesheet" href="${base}/public/bootstrap/css/bootstrap.min.css">
		<link rel="stylesheet" href="${base}/public/font-awesome/css/font-awesome.min.css">
		<link rel="stylesheet" href="${base}/public/css/style.css">
		<link rel="stylesheet" href="${base}/public/dist/css/ionicons.min.css">
		<link rel="stylesheet" href="${base}/public/plugins/datatables/dataTables.bootstrap.css">
		<link rel="stylesheet" href="${base}/public/dist/css/skins/skin-blue.min.css">
		<link rel="stylesheet" href="${base}/public/dist/css/skins/_all-skins.min.css">
	</head>
	<body class="hold-transition skin-blue sidebar-mini">
		<div class="wrapper">
			<!-- Content Wrapper. Contains page content -->
			<div class="content-wrapper">
				<!-- Main content -->
				<section class="content">
						<div class="col-xs-12">
							<div class="box">
								<div class="box-header">
									<div class="form-group row form-right">
										<div class="col-md-1 col-md-offset-1">
											<a class="btn btn-primary btn-sm" onclick="add();" id="addBtn">添加</a>
										</div>
									</div>
								</div>
								<!-- /.box-header -->
								<div class="box-body">
									<table id="datatableId" class="table table-bordered table-hover" style="width:100%;">
										<thead>
											<tr>
												<th>序号</th>
												#foreach ($field in $fieldList)
													<th>${field.comment}</th>
												#end
												<th>操作</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</div>
								<!-- /.box-body -->
							</div>
							<!-- /.box -->
						</div><!-- /.col -->
				</section><!-- /.content -->
			</div><!-- /.content-wrapper -->
	
		</div>
		<!-- ./wrapper -->
	
		<!-- jQuery 2.2.3 -->
		<script src="${base}/public/plugins/jQuery/jquery-2.2.3.min.js"></script>
		<!-- Bootstrap 3.3.6 -->
		<script src="${base}/public/bootstrap/js/bootstrap.min.js"></script>
		<!-- DataTables -->
		<script src="${base}/public/plugins/datatables/jquery.dataTables.min.js"></script>
		<script src="${base}/common/js/layer/layer.js"></script>
		<script type="text/javascript">
			var datatable;
			function initDatatable() {
			    datatable = $('#datatableId').DataTable({
			    	"searching":false,
			    	"bLengthChange": false,
			        "processing": true,
			        "serverSide": true,
			        "stripeClasses": [ 'strip1','strip2' ],
			        "language": {
			            "url": "${base}/public/plugins/datatables/cn.json"
			        },
			        "ajax": {
			            "url": "$base$atUrl/listData.html",
			            "type": "post",
			            /* "data": function (d) {
			            	
			            } */
			        },
			        /* 列表序号 */
			        "fnDrawCallback"    : function(){
			        	var api = this.api();
			        	var startIndex= api.context[0]._iDisplayStart;
					　　    api.column(0).nodes().each(function(cell, i) {
						   　　　　cell.innerHTML = startIndex + i + 1;
						});
			      	},
			
			        "columns": [
			        			{"data": "", "bSortable": false,render: function(data, type, row, meta) {
				                		
				                		return "";
				                    } 	
				                },
			                    #foreach ($field in $fieldList)
									{"data": "${field.name}", "bSortable": false,render: function(data, type, row, meta) {
					                		 var ${field.name} = row.${field.name};
					                		 if(null==${field.name} || ""==${field.name}){
					                			 return "";
					                		 }
					                		 
					                		return ${field.name};
					                    } 	
					                },
								#end
								{"data": " ", "bSortable": false,
			                    	render: function(data, type, row, meta) {
			                        	var modify = '<a style="cursor:pointer;" onclick="edit('+row.id+');">编辑</a>';
			                        
			                          	var judge = '<a onclick="deleteById('+row.id+');" class="btn_mini btn_modify"><font color="#CCCCCC">删除</font></a>';
			                          		
			                            return modify+judge;
			                        }	
			                    } 
			            ],
			        columnDefs: [{}]
			    });
			}
			
			$(function () {
			    initDatatable();
			});
			
			/* layer添加 */
			function add(){
			      layer.open({
			    	    type: 2,
			    	    title: false,
			    	    closeBtn:false,
			    	    fix: false,
			    	    maxmin: false,
			    	    shadeClose: false,
			    	    scrollbar: false,
			    	    area: ['900px', '550px'],
			    	    content: '$base$atUrl/add.html'
			    	  });
			  }
			/* layer编辑 */
			function edit(id){
			      layer.open({
			    	    type: 2,
			    	    title: false,
			    	    closeBtn:false,
			    	    fix: false,
			    	    maxmin: false,
			    	    shadeClose: false,
			    	    scrollbar: false,
			    	    area: ['900px', '550px'],
			    	    content: '$base$atUrl/update.html?id='+id
			    	  });
			  }
			  
			  //删除提示
			function deleteById(id) {
				layer.confirm("您确认要删除吗？", {
				    btn: ["是","否"], //按钮
				    shade: false //不显示遮罩
				}, function(){
					// 点击确定之后
					var url = '$base$atUrl/delete.html';
					$.ajax({
						type : 'POST',
						data : {
							id : id
						},
						dataType : 'json',
						url : url,
						success : function(data) {
							layer.msg("删除成功!",{time:2000});
							datatable.ajax.reload();
						},
						error : function(xhr) {
							layer.msg("删除失败",{time:2000});
						}
					});
				}, function(){
				    // 取消之后不用处理
				});
			}
		
		</script>
	</body>
</html>